{% extends 'baselayout.html' %}
{% load i18n %}
{% load stylesheet %}
{% load annotation_idgloss_translation %}
{% load has_group %}
{% load bootstrap3 %}

{% load guardian_tags %}


{% block extrajs %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.mini.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.checkbox.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>

    <script type='text/javascript'>
    var url = '{{ PREFIX_URL }}';

    var edit_mode_str = '{% trans "Edit" %}';
    var turn_off_edit_mode_str = '{% trans "Turn off edit mode" %}';
    var saving_str = '{% trans "Saving..." %}'
    var csrf_token = '{{csrf_token}}';
    </script>
<style>
list {
    overflow-y: scroll;
    overflow-x: auto;
    scrollbar-width: thin;
}
dl:after {
    content: none;
}
dl {
    margin-bottom: 0px;
}
dt {
    margin-left: 0px;
}
dd {
    margin-left: 0px;
}

.list-group-item.active {
    background-color: #fff;
    color: #000;
}
.list-group-item.active:hover {
    color: #000;
}
.list-group-item {
    justify-content: space-between;
    display: flex;
    color: black;
    overflow: visible;
    margin-right: 10px;
    scrollbar-gutter: auto;
}
.list-group-item:hover {
    color: #428bca;
}
.check {
    height: 14px;
    width: 7px;
    border-bottom: 2px solid green;
    border-right: 2px solid green;
    transform: rotate(45deg);
    margin: 3px;
}
</style>
{% endblock %}

{% block bootstrap3_title %}
{% blocktrans %}Dataset Media{% endblocktrans %}
{% endblock %}

{% block content %}
<div>
<h3>{% trans "Dataset Media Manager" %}</h3>

    <div class='pull-right'>
        {% get_obj_perms request.user for dataset as "dataset_perms" %}
        {% if "change_dataset" in dataset_perms %}
        {% if request.user|has_group:"Dataset_Manager" %}
         <span id='edit_message' style="padding-right: 1.8em;"></span>
         <button id='enable_edit' class='btn btn-default navbar-btn'>{% trans "Edit" %}</button>
         {% endif %}
         {% endif %}
    </div>

    <table class='table table-responsive'>
        <tr><th style="width:200px;">{% trans "Dataset name" %}</th><td style="width:600px;">{{dataset.name}}</td></tr>
        <tr><th>{% trans "Acronym" %}</th><td class='edit edit_text' align="left" id='acronym' name='acronym'
                value="{{datasetform.acronym.value|default:'-'}}">{{dataset.acronym}}</td></tr>
        <tr><th>Number of glosses</th><td>{{nr_of_public_glosses}} public glosses, {{nr_of_glosses}} total</td></tr>
        <tr><th>{% trans "Accessible by others" %}</th>
            <td id='is_public'>{% if dataset.is_public %}True{% else %}False{% endif %}
            </td>
        </tr>
        <tr>
        <th>
          <div class="text-container"><p>{% trans "Videos Archive" %}</p></div>
        </th>
        <td>
            <form id="upload_zipped_videos_{{dataset.acronym}}"
                  action="{{PREFIX_URL}}/dictionary/upload_zipped_videos_folder/"
                  method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="id_file">{{zippedvideosform.label}}</label>
                <span>{{zippedvideosform.file}}</span>
                <input type='hidden' name='dataset' value='{{dataset.id}}'>
                <input type="submit" value="Upload Zipped File" class="btn btn-primary">
            </form>
        </td>
        </tr>
        <tr>
        <th>
          <div class="text-container"><p>{% trans "Zipped Archives" %}</p></div>
        </th>
        <td>
          <div name="zipped_archives"
                style="height:250px; overflow-y:auto;display:block; width:600px;">
              <ul class="list-group-hover" style="padding: 0;">
                  {% for zipfilename, zipcontents in zipped_archives.items %}
                  <li class="list-group-item active" style="padding: 0;">
                      <span>{{zipfilename}}</span><span>{% trans "IMPORT STATUS" %}</span></li>
                  <ul>
                    {% for struct, status in zipcontents.items %}
                    <li class="list-group-item" style="padding: 0;">
                        {% if status %}
                        <span>{{struct}}</span><span class="check"></span>
                        {% else %}
                        <span>{{struct}}</span><span>&#10060;</span>
                        {% endif %}
                    </li>
                    {% endfor %}
                  </ul>
                  {% endfor %}
            </ul>
          </div>
        </td>
        </tr>
        <tr>
            <th>{% trans "Status Video Files in Import Folder" %}</th>
            <td>
              <div name="status_uploaded_video_files"
                    style="height:250px; overflow-y:auto;display:block; width:600px;">
                  <list class="list-group-hover" style="padding:0;">
                      {% for lang3char, status_files in status_uploaded_files.items %}
                      {% if status_files %}
                      <li class="list-group-item active" style="padding: 0;">
                          <span>import_videos/{{dataset.acronym}}/{{lang3char}}/</span>
                          <span>{% trans "GLOSS IDENTIFIED" %}</span>
                      </li>
                      {% for videofile, video_format_okay, gloss in status_files %}
                      {% if video_format_okay and gloss %}
                      <li class="list-group-item" style="padding:0;">
                          <span>import_videos/{{dataset.acronym}}/{{lang3char}}/{{videofile}}</span>
                          <span>{{gloss|get_default_annotation_idgloss_translation}}</span></li>
                      {% elif gloss %}
                    <li class="list-group-item" style="padding: 0;">
                        <span>import_videos/{{dataset.acronym}}/{{lang3char}}/{{videofile}}</span>
                        <span style="color:red">(video is not mp4)</span>
                    </li>
                    {% else %}
                    <li class="list-group-item" style="padding: 0;">
                        <span>import_videos/{{dataset.acronym}}/{{lang3char}}/{{videofile}}</span>
                        <span style="color:red"><span>&#10060;</span></span>
                    </li>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% endfor %}
                </list>
              </div>
            </td>
        </tr>
    </table>

</div>

{% endblock %}
