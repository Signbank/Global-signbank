{% extends "baselayout.html" %}
{% load i18n %}
{% load annotation_idgloss_translation %}
{% load bootstrap3 %}
{% block bootstrap3_title %}
{% blocktrans %}Signbank: Homonym List{% endblocktrans %}
{% endblock %}

{% block extrahead %}
{% endblock %}

<head>
{% block extrajs %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.mini.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.checkbox.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>

<script type='text/javascript'>
var csrf_token = '{{csrf_token}}';
var ids_of_all_glosses = {{ids_of_all_glosses|safe}};
var url = '{{ PREFIX_URL }}'

function show_homonyms(data) {
    if ($.isEmptyObject(data)) {
        return;
    };
    var glossid = data.glossid;
    var same_phonology = data.same_phonology;
    var saved_relations = data.saved_relations;
    var focus_gloss_row = $("#focus_gloss_row_"+glossid);
    if (saved_relations == 0 && same_phonology.length == 0) {
        focus_gloss_row.css('display', 'none');
        return;
    }
    var relationsCell = $("#homonyms_"+glossid);
    var num_spaces = same_phonology.length - 1;
    var cell = "";
    for (var key in same_phonology) {
        if (key < num_spaces) {
            cell += '<span><a href="'+url+'/dictionary/gloss/'+same_phonology[key].id+'/">' + same_phonology[key].gloss + '</a> &nbsp; </span>';
        } else {
            cell += '<span><a href="'+url+'/dictionary/gloss/'+same_phonology[key].id+'/">' + same_phonology[key].gloss + '</a></span>';
        }
    }
    relationsCell.html(cell);
}

// This script gets homonym objects
$(document).ready(function() {
    for (var i = 0; i < ids_of_all_glosses.length; i++) {
        $.ajax({
            url : url + "/ajax/homonyms/" + ids_of_all_glosses[i] + "/",
            datatype: "json",
            success : show_homonyms
        });
    }
});
</script>
{% endblock %}
</head>

{% block content %}
<body>
<div id="definitionblock">
    {% url 'dictionary:protected_media' '' as protected_media_url %}

{% if object_list %}
<table class='table table-condensed'>
    <thead>
      <tr>
          <th>{% trans "Focus Gloss" %} ({{language}})</th>
          <th>{% trans "Homonym Relations (SAVED)" %}</th>
          <th>{% trans "Homonym Relations (SAME PHONOLOGY)" %}</th>
      </tr>
    </thead>
    <tbody>
    {% for focus_gloss in object_list %}
    <tr id="focus_gloss_row_{{focus_gloss.id}}" style="display: visible;">
    {% with focus_gloss.homonym_relations as homonyms_saved %}
            <td>
                <a href="{{PREFIX_URL}}/dictionary/gloss/{{ focus_gloss.pk }}/">{{ focus_gloss|get_annotation_idgloss_translation:language }}</a>
            </td>
            <td>
                {% for gl, seen in homonyms_saved %}
                    <a style="padding-left: 20px;{% if seen %}color:red;{% endif %}"
                       href='{% url "dictionary:admin_gloss_view" pk=gl.pk %}'>{{ gl|get_annotation_idgloss_translation:language }}</a>
                {% endfor %}
            </td>
            <td class="focus_gloss_homonym_objects" id="homonyms_{{focus_gloss.id}}" >

            </td>
    {% endwith %}
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
{% trans "No homonyms found." %}
{% endif %}

</div>
</body>
{% endblock content %}
