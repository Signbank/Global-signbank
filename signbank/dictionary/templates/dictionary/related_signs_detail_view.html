{% extends 'baselayout.html' %}
{% load i18n %}
{% load stylesheet %}
{% load annotation_idgloss_translation %}

{% load bootstrap3 %}

{% block bootstrap3_title %}
{% blocktrans %}Relations for {{ gloss }}{% endblocktrans %}
{% endblock %}

{% block extrahead %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/tagmanager.css">
{% endblock %}

{% block extrajs %}

    <script type='text/javascript'>

    var url = '{{ PREFIX_URL }}';
    var this_gloss_id = {{gloss.id}};

    var search_results_url = '{% url 'dictionary:ajax_search_results' %}';

    {% include "dictionary/search_result_bar.html" %}	

    </script>

    <script type='text/javascript'>
        // This script gets minimal pairs data and displays it as table rows
        $(document).ready(function() {
            lookup = "#header_mp_rows";
			$.ajax({
				url : url + "/ajax/minimalpairs/" + this_gloss_id + "/",
				datatype: "json",
				async: true,
				data: { 'gloss_detail': false },
				success : function(result) {
					var elem = $(result);
					$(lookup).last().after(result);
				}
			});
        });
    </script>
{% endblock %}

{% block content %}
{% url 'dictionary:protected_media' '' as protected_media_url %}
{% load field_choice %}

<div id="searchresults" class='navbar' style="overflow-y:hidden;background-color:white;border:0;box-sizing:content-box; z-index: 50;">
    {% if request.session.search_results %}{# See if search_results in sessions is empty #}
    <div id="results-inline" class="btn-group" role="group" aria-label="search results" style="white-space:nowrap;background-color:white;">
    </div>
    {% endif %}
</div>

<div id="signinfo" class='navbar navbar-collapse' style="background-color:white;border:0;">

    <div class='btn-group'>
        {% if SIGN_NAVIGATION %}

            {% if navigation.prev %}
            <a class='btn navbar-btn btn-default' href="{% url 'dictionary:admin_gloss_view' pk=navigation.prev.id %}">&laquo;{% trans "Previous Sign" %]
            </a>
            {% endif %}

            <button class='btn navbar-btn'>{% blocktrans %}"Sign {{glossposn}} of {{glosscount}} in the dictionary" {% endblocktrans %}</button>

            {% if navigation.next %}
            <a class="btn navbar-btn btn-default"
               href="{% url 'dictionary:admin_gloss_view' pk=navigation.next.id %}">{% trans "Next Sign &raquo;" %}</a>
            {% endif %}
         {% endif %}
    </div>

	<ul class='nav nav-tabs'>
		<li class="nav-item">
			<a class='nav-link' href="{{PREFIX_URL}}/dictionary/gloss/{{gloss.id}}.html">{% trans "Public View" %}</a>
		</li>
		<li class="nav-item">
			<a class='nav-link' href="{{PREFIX_URL}}/dictionary/gloss/{{gloss.id}}">{% trans "Detail View" %}</a>
		</li>
		<li class="nav-item">
			<a class='nav-link active' href="{{PREFIX_URL}}/dictionary/gloss_relations/{{gloss.id}}">{% trans "Relations View" %}</a>
		</li>
		{% if gloss.has_frequency_data %}
		<li class="nav-item">
			<a class='nav-link' href="{{PREFIX_URL}}/dictionary/gloss_frequency/{{gloss.id}}/">{% trans "Frequency View" %}</a>
		</li>
		{% endif %}
		<li class="nav-item">
			<a class='nav-link' href="{{PREFIX_URL}}/dictionary/gloss/{{gloss.id}}/history">{% trans "Revision History" %}</a>
		</li>
	</ul>

</div>

<div id="definitionblock">

	<div  class="panel panel-default">

	<table class='table table-condensed'>
		<thead>
		  <tr>
			  <th style="width:9em; color:darkred">{% trans "Source Sign" %}</th>

			  {% for lang, annotation_idgloss_translation in annotation_idgloss.items %}
					<th style='width:12em'>
						{% trans "Annotation ID Gloss" %} ({{ lang }})
					</th>
			  {% endfor %}

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th style="width:8em">{% trans "Handedness" %}</th>
			   <th style="width:6em">{% trans "Strong hand" %}</th>
			   <th style="width:6em">{% trans "Weak hand" %}</th>
			   <th style="width:8em">{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		</thead>
		<tbody>
		  <tr>
			  <td>{%if gloss.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{gloss.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{gloss.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
				</td>

			  {% for lang, annotation_idgloss_translation in annotation_idgloss.items %}
					<td id='annotation_idgloss_{{ lang.language_code_2char }}'>
						<a href='{% url "dictionary:admin_gloss_view" pk=gloss.id %}'>{{ annotation_idgloss_translation }}</a></td>
			  {% endfor %}

			  <td id='src_keywords'>{% for trn in gloss.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='src_handedness'>{{ gloss.get_handedness_display }}</td>
					<td id='src_domhndsh'>{{ gloss.get_domhndsh_display }}</td>
					<td id='src_subhndsh'>{{ gloss.get_subhndsh_display }}</td>
					<td id='src_locprim'>{{ gloss.get_locprim_display }}</td>

			  {% load underscore_to_space %}
			  <td>{% for tag in gloss.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		</tbody>

			{% if lemma_group %}
			<thead></thead>
			<tbody>
				<tr style="outline: thin solid; color: #ddd;"><th style="width:8em; color:darkred">{% trans "Lemma Group" %}</th>
					<td id='lemma_group'>
						{% if lemma_group %}
							<a href='{{ lemma_group_url }}'>{% value gloss.idgloss %}</a>
						{% else %}
							{% value gloss.idgloss %}
						{% endif %}
					</td>
				</tr>
				<tr style="outline: thin solid; color: #ddd;">
					<th style="width:8em; color:darkred">{% trans "Glosses" %}</th>
					<td id='lemma_group_glosses' style="color:black;" colspan="8">
						{% for gl, gl_display in glosses_in_lemma_group %}
						<a href='{% url "dictionary:admin_gloss_view" pk=gl.id %}'>{{ gl_display }}</a>{% if not forloop.last %}, {% endif %}
						{% endfor %}
					</td>
				</tr>
			</tbody>
			{% endif %}

			<tbody></tbody>
		   <thead>
		   {% if gloss.homonyms_count %}
		   <tr>
			   <th style="width:8em; color:darkred">{% trans "Homonyms" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th style="width:8em">{% trans "Handedness" %}</th>
			   <th style="width:8em">{% trans "Strong hand" %}</th>
			   <th style="width:8em">{% trans "Weak hand" %}</th>
			   <th style="width:8em">{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		   </thead>
		<tbody>
		 {% with gloss.homonym_relations as homonyms_saved %}
		 {% for gl, seen in homonyms_saved %}
		  <tr>
				<td>{%if gl.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{gl.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{gl.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
				</td>
			  <td id='homo_idgloss'><a {% if seen %} style="color:red;" {% endif %}
                       href='{% url "dictionary:admin_gloss_view" pk=gl.pk %}'>{{ gl|get_annotation_idgloss_translation:language }}</a></td>
			  <td id='homo_dataset'>{{gl.dataset}}</td>
			  <td id='homo_keywords'>{% for trn in gl.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>

					<td id='homo_handedness'>{{ gl.get_handedness_display }}</td>
					<td id='homo_domhndsh'>{{ gl.get_domhndsh_display }}</td>
					<td id='homo_subhndsh'>{{ gl.get_subhndsh_display }}</td>
					<td id='homo_locprim'>{{ gl.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in gl.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		 {% endfor %}
		 {% endwith %}
		</tbody>

		   <thead>
		   {% if gloss.synonyms_count %}
		   <tr>
			   <th style="width:8em; color:darkred">{% trans "Synonyms" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th>{% trans "Handedness" %}</th>
			   <th>{% trans "Strong hand" %}</th>
			   <th>{% trans "Weak hand" %}</th>
			   <th>{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		 </thead>
		<tbody>
		 {% for rel, target_display in otherrelations %}
		  {% if rel.role == "synonym" %}
		  <tr>
				 <td>{%if rel.target.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{rel.target.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{rel.target.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
				</td>
			  <td id='syno_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=rel.target.pk %}'>{{target_display}}</a></td>
			  <td id='syno_dataset'>{{rel.target.dataset}}</td>
			  <td id='syno_keywords'>{% for trn in rel.target.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='syno_handedness'>{{ rel.target.get_handedness_display }}</td>
					<td id='syno_domhndsh'>{{ rel.target.get_domhndsh_display }}</td>
					<td id='syno_subhndsh'>{{ rel.target.get_subhndsh_display }}</td>
					<td id='syno_locprim'>{{ rel.target.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in rel.target.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		  {% endif %}
		  {% endfor %}
		</tbody>

		<thead>
		   {% if gloss.antonyms_count %}
		   <tr>
			   <th style="width:8em; color:darkred">{% trans "Antonyms" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th>{% trans "Handedness" %}</th>
			   <th>{% trans "Strong hand" %}</th>
			   <th>{% trans "Weak hand" %}</th>
			   <th>{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		</thead>
		<tbody>
		 {% for rel, target_display in otherrelations %}
		  {% if rel.role == "antonym" %}
		  <tr>
			  <td>{%if rel.target.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{rel.target.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{rel.target.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
			  </td>
			  <td id='anto_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=rel.target.pk %}'>{{target_display}}</a></td>
			  <td id='anto_dataset'>{{rel.target.dataset}}</td>
			  <td id='anto_keywords'>{% for trn in rel.target.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='anto_handedness'>{{ rel.target.get_handedness_display }}</td>
					<td id='anto_domhndsh'>{{ rel.target.get_domhndsh_display }}</td>
					<td id='anto_subhndsh'>{{ rel.target.get_subhndsh_display }}</td>
					<td id='anto_locprim'>{{ rel.target.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in rel.target.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		  {% endif %}
		  {% endfor %}
		</tbody>

		<thead>
		   {% if gloss.hyponyms_count %}
			<tr>
				<th style="width:8em; color:darkred">{% trans "Hyponyms" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th>{% trans "Handedness" %}</th>
			   <th>{% trans "Strong hand" %}</th>
			   <th>{% trans "Weak hand" %}</th>
			   <th>{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		</thead>
		<tbody>
		 {% for rel, target_display in otherrelations %}
		  {% if rel.role == "hyponym" %}
		  <tr>
			  <td>{%if rel.target.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{rel.target.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{rel.target.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
			  </td>
			  <td id='hypo_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=rel.target.pk %}'>{{target_display}}</a></td>
			  <td id='hypo_dataset'>{{rel.target.dataset}}</td>
			  <td id='hypo_keywords'>{% for trn in rel.target.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='hypo_handedness'>{{ rel.target.get_handedness_display }}</td>
					<td id='hypo_domhndsh'>{{ rel.target.get_domhndsh_display }}</td>
					<td id='hypo_subhndsh'>{{ rel.target.get_subhndsh_display }}</td>
					<td id='hypo_locprim'>{{ rel.target.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in rel.target.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		  {% endif %}
		  {% endfor %}
		</tbody>

		<thead>
		   {% if gloss.hypernyms_count %}
			<tr>
			   <th style="width:8em; color:darkred">{% trans "Hypernyms" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th>{% trans "Handedness" %}</th>
			   <th>{% trans "Strong hand" %}</th>
			   <th>{% trans "Weak hand" %}</th>
			   <th>{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		</thead>
		<tbody>
		 {% for rel, target_display in otherrelations %}
		  {% if rel.role == "hypernym" %}
		  <tr>
			  <td>{%if rel.target.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{rel.target.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{rel.target.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
			  </td>
			  <td id='hyper_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=rel.target.pk %}'>{{target_display}}</a></td>
			  <td id='hyper_dataset'>{{rel.target.dataset}}</td>
			  <td id='hyper_keywords'>{% for trn in rel.target.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='hyper_handedness'>{{ rel.target.get_handedness_display }}</td>
					<td id='hyper_domhndsh'>{{ rel.target.get_domhndsh_display }}</td>
					<td id='hyper_subhndsh'>{{ rel.target.get_subhndsh_display }}</td>
					<td id='hyper_locprim'>{{ rel.target.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in rel.target.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		  {% endif %}
		  {% endfor %}
		</tbody>

		<thead>
		   {% if gloss.seealso_count %}
			<tr>
			   <th style="width:8em; color:darkred">{% trans "See Also" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th>{% trans "Handedness" %}</th>
			   <th>{% trans "Strong hand" %}</th>
			   <th>{% trans "Weak hand" %}</th>
			   <th>{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		</thead>
		<tbody>
		 {% for rel, target_display in otherrelations %}
		  {% if rel.role == "seealso" %}
		  <tr>
			  <td>{%if rel.target.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{rel.target.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{rel.target.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
			  </td>
			  <td id='seealso_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=rel.target.pk %}'>{{target_display}}</a></td>
			  <td id='seealso_dataset'>{{rel.target.dataset}}</td>
			  <td id='seealso_keywords'>{% for trn in rel.target.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='seealso_handedness'>{{ rel.target.get_handedness_display }}</td>
					<td id='seealso_domhndsh'>{{ rel.target.get_domhndsh_display }}</td>
					<td id='seealso_subhndsh'>{{ rel.target.get_subhndsh_display }}</td>
					<td id='seealso_locprim'>{{ rel.target.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in rel.target.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		  {% endif %}
		  {% endfor %}
		</tbody>

		<thead>
		   {% if variants %}
		   <tr>
			   <th style="width:8em; color:darkred">{% trans "Variants" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th style='width:12em'>{% trans "Dataset" %}</th>

			   <th style='width:12em'>{% trans "Translation equivalents" %}</th>
			   <th>{% trans "Handedness" %}</th>
			   <th>{% trans "Strong hand" %}</th>
			   <th>{% trans "Weak hand" %}</th>
			   <th>{% trans "Location" %}</th>
			   <th style='width:12em'>{% trans "Tags" %}</th>
		  </tr>
		 {% endif %}
		   </thead>
		<tbody>
		 {% for gl, gl_display in variants %}
		  <tr>
			  <td>{%if gl.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{gl.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{gl.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
			  </td>
			  <td id='var_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=gl.id %}'>{{gl_display}}</a></td>
			  <td id='var_dataset'>{{gl.dataset}}</td>
			  <td id='var_keywords'>{% for trn in gl.translation_set.all %}{{ trn.translation.text|safe }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
					<td id='var_handedness'>{{ gl.get_handedness_display }}</td>
					<td id='var_domhndsh'>{{ gl.get_domhndsh_display }}</td>
					<td id='var_subhndsh'>{{ gl.get_subhndsh_display }}</td>
					<td id='var_locprim'>{{ gl.get_locprim_display }}</td>
			  {% load underscore_to_space %}
			  <td>{% for tag in gl.tags %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
		  </tr>
		  {% endfor %}
		</tbody>


            {% if minimalpairs %}
               <tr>
				   <th style="width:auto; color:darkred" >{% trans "Minimal Pairs" %}</th>
				   <td style='width:12em' colspan="8">
					   <table id="header_mp_rows"></table>
				   </td>
			   </tr>
            {% endif %}

		{% if compounds %}
		<thead>
		   <tr>
			   <th style="width:8em; color:darkred">{% trans "Compounds" %}</th>

			   <th style='width:12em'>{% trans "Annotation ID Gloss" %}</th>
			   <th colspan="2" style='width:12em'>{% trans "Sequential morphology" %}</th>

		   </tr>
		</thead>
		<tbody>
		{% for c, c_display in compounds %}
		<tr>
			  <td>{%if c.get_image_path %}
				  <div class="thumbnail_container">
				  <a href="{{PREFIX_URL}}/dictionary/gloss/{{c.pk}}/">
					  <img class="thumbnail" src="{{protected_media_url}}{{c.get_image_path}}">
				  </a>
				  </div>
				  {% endif %}
			  </td>
			  {% with request.LANGUAGE_CODE as lang %}
			  <td id='comp_idgloss'><a href='{% url "dictionary:admin_gloss_view" pk=c.pk %}'>{{c|translated_annotationidgloss:lang}}</a></td>
			  {% endwith %}
			  <td colspan="2" id='comp_dataset'>
                    {% if c.parent_glosses.all.count > 0 %}
				  	{% with request.LANGUAGE_CODE as lang %}
                    {% with c.parent_glosses.all as components %}
                    {% with components|dictsort:"role" as sorted_components %}
                    {% for component in sorted_components %}
				    {% with component.morpheme as comp %}
                    <span>
						<a href='{% url "dictionary:admin_gloss_view" pk=component.morpheme.pk %}'>
							{% if comp.pk == gloss.pk %}<strong>{% endif %}
							{{comp|translated_annotationidgloss:lang}}</a>{% if comp.pk == gloss.pk %}</strong>{% endif %}
						{% if not forloop.last %} + {% endif %}
                    </span>
				    {% endwith %}
                    {% endfor %}
                    {% endwith %}
                    {% endwith %}
				    {% endwith %}
                    {% endif %}
			  </td>

		</tr>
		{% endfor %}

		</tbody>
		{% endif %}

	</table>

	</div>
</div>


{% endblock %}
