{% extends "baselayout.html" %}
{% load i18n %}
{% load annotation_idgloss_translation %}
{% load bootstrap3 %}
{% load tagging_tags %}
{% load wrong_sign %}
{% block bootstrap3_title %}Signbank: Search Signs{% endblock %}
{% block extrahead %}
{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.mini.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.checkbox.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>
    <script type='text/javascript' src="{{ STATIC_URL }}js/lemma_typeahead.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/gloss_add.js"></script>
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.full.min.js"></script>
<script type='text/javascript'>
    var url = '{{URL}}';
    var show_dataset_interface_options = {{ SHOW_DATASET_INTERFACE_OPTIONS|yesno:"true,false" }};
    lemma_create_field_prefix = "{{ lemma_create_field_prefix }}"

     $(document).ready(function(){

        $('.collapsetoggle').click(function() {
            if ($(this).text() == 'Show') {
                $(this).text('Hide');
            } else {
                $(this).text('Show');
            }
        });

        $('[data-toggle="tooltip"]').tooltip();

        if (show_dataset_interface_options) {

            /**
             * In the 'add gloss' form, toggle the annotation idgloss fields depending on the chosen dataset
             */
             set_annotationidglosslanguages();

             $('#id_dataset').change(function() {
                console.log("Dataset changed");
                set_annotationidglosslanguages();
             });
         }

         $('#id_handedness').attr('multiple','multiple');
         $('#id_handedness').attr('class',"js-example-basic-multiple form-control");
         $('#id_handedness').attr('name','handedness[]');
         $('#id_handedness').css('width', '100%');
         $('#id_handedness').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_handedness').val(null).trigger('change');

         $('#id_domhndsh').attr('multiple','multiple');
         $('#id_domhndsh').attr('class',"js-example-basic-multiple form-control");
         $('#id_domhndsh').attr('name','domhndsh[]');
         $('#id_domhndsh').css('width', '100%');
         $('#id_domhndsh').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_domhndsh').val(null).trigger('change');

         $('#id_subhndsh').attr('multiple','multiple');
         $('#id_subhndsh').attr('class',"js-example-basic-multiple form-control");
         $('#id_subhndsh').attr('name','subhndsh[]');
         $('#id_subhndsh').css('width', '100%');
         $('#id_subhndsh').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_subhndsh').val(null).trigger('change');

         $('#id_handCh').attr('multiple','multiple');
         $('#id_handCh').attr('class',"js-example-basic-multiple form-control");
         $('#id_handCh').attr('name','handCh[]');
         $('#id_handCh').css('width', '100%');
         $('#id_handCh').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_handCh').val(null).trigger('change');

         $('#id_relatArtic').attr('multiple','multiple');
         $('#id_relatArtic').attr('class',"js-example-basic-multiple form-control");
         $('#id_relatArtic').attr('name','relatArtic[]');
         $('#id_relatArtic').css('width', '100%');
         $('#id_relatArtic').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_relatArtic').val(null).trigger('change');

         $('#id_locprim').attr('multiple','multiple');
         $('#id_locprim').attr('class',"js-example-basic-multiple form-control");
         $('#id_locprim').attr('name','locprim[]');
         $('#id_locprim').css('width', '100%');
         $('#id_locprim').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_locprim').val(null).trigger('change');

         $('#id_relOriMov').attr('multiple','multiple');
         $('#id_relOriMov').attr('class',"js-example-basic-multiple form-control");
         $('#id_relOriMov').attr('name','relOriMov[]');
         $('#id_relOriMov').css('width', '100%');
         $('#id_relOriMov').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_relOriMov').val(null).trigger('change');

         $('#id_relOriLoc').attr('multiple','multiple');
         $('#id_relOriLoc').attr('class',"js-example-basic-multiple form-control");
         $('#id_relOriLoc').attr('name','relOriLoc[]');
         $('#id_relOriLoc').css('width', '100%');
         $('#id_relOriLoc').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_relOriLoc').val(null).trigger('change');

         $('#id_oriCh').attr('multiple','multiple');
         $('#id_oriCh').attr('class',"js-example-basic-multiple form-control");
         $('#id_oriCh').attr('name','oriCh[]');
         $('#id_oriCh').css('width', '100%');
         $('#id_oriCh').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_oriCh').val(null).trigger('change');

         $('#id_contType').attr('multiple','multiple');
         $('#id_contType').attr('class',"js-example-basic-multiple form-control");
         $('#id_contType').attr('name','contType[]');
         $('#id_contType').css('width', '100%');
         $('#id_contType').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_contType').val(null).trigger('change');

         $('#id_movSh').attr('multiple','multiple');
         $('#id_movSh').attr('class',"js-example-basic-multiple form-control");
         $('#id_movSh').attr('name','movSh[]');
         $('#id_movSh').css('width', '100%');
         $('#id_movSh').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_movSh').val(null).trigger('change');

         $('#id_movDir').attr('multiple','multiple');
         $('#id_movDir').attr('class',"js-example-basic-multiple form-control");
         $('#id_movDir').attr('name','movDir[]');
         $('#id_movDir').css('width', '100%');
         $('#id_movDir').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_movDir').val(null).trigger('change');


         $('#id_namEnt').attr('multiple','multiple');
         $('#id_namEnt').attr('class',"js-example-basic-multiple form-control");
         $('#id_namEnt').attr('name','namEnt[]');
         $('#id_namEnt').css('width', '100%');
         $('#id_namEnt').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_namEnt').val(null).trigger('change');

         $('#id_semField').attr('multiple','multiple');
         $('#id_semField').attr('class',"js-example-basic-multiple form-control");
         $('#id_semField').attr('name','semField[]');
         $('#id_semField').css('width', '100%');
         $('#id_semField').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_semField').val(null).trigger('change');

         $('#id_wordClass').attr('multiple','multiple');
         $('#id_wordClass').attr('class',"js-example-basic-multiple form-control");
         $('#id_wordClass').attr('name','wordClass[]');
         $('#id_wordClass').css('width', '100%');
         $('#id_wordClass').select2({
            allowClear: true,
            dropdownAutoWidth: true,
            width: 'resolve'
         });
         $('#id_wordClass').val(null).trigger('change');

});



// http://www.javascript-coder.com/javascript-form/javascript-reset-form.phtml
function clearForm(myFormElement) {

  var elements = myFormElement.elements;

  myFormElement.reset();

  for(i=0; i<elements.length; i++) {

      field_type = elements[i].type.toLowerCase();

      switch(field_type) {

        case "text":
        case "password":
        case "textarea":
        case "hidden":

          elements[i].value = "";
          break;

        case "radio":
        case "checkbox":
          if (elements[i].checked) {
              elements[i].checked = false;
          }
          break;

        case "select-one":
        case "select-multiple":
          elements[i].selectedIndex = -1;
          break;

        default:
          break;
      }
    }
    return(false);
}

/**
 * @param {string} field_name - name of the field to sort on
 * @param {string} action     - one of: desc, asc, del
 * @param {string} frmName    - name of the <form ...> that contains the 'sortOrder' <input> field
 * @returns {void}
 */
function do_sort_column(field_name, action, frmName) {
  // Combine @field_name and @action into [sOrder]
  var sOrder = field_name;
  if (action == 'desc') {
    // Descending sort order is signified by a '-' prefix
    sOrder = '-' + sOrder;
  } else if (action == 'del') {
    // "Deleting" (pressing 'x') the sort order of a column means: return to the default 'idgloss' sort order
    sOrder = 'idgloss';
  }

  // Set the value of the [sortOrder] field defined in dictionary/forms.py::GlossSearchForm
  $("#" + frmName + " input[name='sortOrder']").val(sOrder);

  // Submit the form with the indicated name
  $("#" + frmName).submit();
}

/**
 * @returns {void}
 */
function do_adminsearch(el) {
 var sSearchType = $(el).attr('value');
  $("#adminsearch input[name='search_type']").val(sSearchType);
  switch(sSearchType) {
    case "morpheme":
        $("#adminsearch").attr('action', '{{URL}}/morphemes/search/');
        break;
    case "sign":
        $("#adminsearch").attr('action', '{{URL}}/signs/search/');
        break;
    case "sign_or_morpheme":
        $("#adminsearch").attr('action', '{{URL}}/signs/search/');
        break;
  }
  document.getElementById('adminsearch').submit();
}

/**
 * toggle between normal list view and lemma group list view
 */
function do_toggle_groups(el) {
  var sViewType = $(el).attr('value');
  $("#toggle_groups input[name='view_type']").val(sViewType);
  console.log('switch');
  console.log(sViewType);
  switch(sViewType) {
    case "lemma_groups":
        $(el).val('gloss_list');
        console.log('change to gloss list');
        $(el).html("Gloss View");
        break;
    case "gloss_list":
        $(el).val('lemma_groups');
        console.log('change to lemma groups');
        $(el).html("Lemma View");
        break;
  }
  document.getElementById('adminsearch').submit();
}
   </script>

    <script type='text/javascript' src="{{ STATIC_URL }}js/gloss_search.js"></script>

{% endblock %}


{% block content %}
{% url 'dictionary:protected_media' '' as protected_media_url %}

{% if perms.dictionary.search_gloss %}

{{ form.media.css }}
{{ form.media.js }}

<form name='adminsearch' id='adminsearch' method='get' action='{{URL}}/signs/search'>
<div class="panel panel-default">
    <div class="panel-heading" data-toggle="collapse" data-target="#query-area">{% trans "Form your query" %}
                <span id="tooltip" class="glyphicon glyphicon-question-sign" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" data-html="true"
                  title="In many text fields, you can use patterns as follows:
                  <table>
                    <tr>
                        <td align='right'>A</td><td>&nbsp;&nbsp;</td><td align='left'>{% trans "contains A" %}</td>
                    </tr>
                    <tr>
                        <td align='right'>^A</td><td>&nbsp;&nbsp;</td><td align='left'>{% trans "starts with A" %}</td>
                    </tr>
                    <tr>
                        <td align='right'>A$</td><td>&nbsp;&nbsp;</td><td align='left'>{% trans "ends with A" %}</td>
                    </tr>
                    <tr>
                        <td align='right'>A|B</td><td>&nbsp;&nbsp;</td><td align='left'>{% trans "A or B" %}</td>
                    </tr>
                    <tr>
                        <td align='right'>.*</td><td>&nbsp;&nbsp;</td><td align='left'>{% trans "find all strings in this field" %}</td>
                    </tr>
                    <tr>
                        <td align='right'>(</td><td>&nbsp;&nbsp;</td><td align='left'>{% trans "use backslash to find <br/>special characters in field" %}</td>
                    </tr>
                  </table>
                  "></span></div>

    <div id='query-area' class='collapse {% if request.GET|length == 0 and not show_all %} in {% endif %}'>
        <div id='searchformwell' class='well search-results-collapsable'>

                <!-- EK: A sort-order specification is in a hidden form field, which is filled by JS:do_sort_column() -->
                <div class="hidden">
                    <input name='sortOrder' class='form-control' value='idgloss' >
                    <input name='search_type' class='form-control' value='{{search_type}}'>
                </div>
                <div>
                    <table class='table' id='searchfields'>
                        {% for dataset_lang in dataset_languages %}

                        <tr>
                            {% with searchform|get_search_field_for_language:dataset_lang as search_field %}
                            <td>
                                <div class='input-group'>
                                <label class='input-group-addon' for='id_annotation_idgloss_{{ dataset_lang.language_code_2char }}'>
                                    {{search_field.label}}
                                </label>
                                <input name='glosssearch_{{ dataset_lang.language_code_2char }}' class='form-control' {% if search_field.value %}value='{{search_field.value}}'{% endif %}>
                                </div>
                            </td>
                            {% endwith %}

                            {% with searchform|get_lemma_field_for_language:dataset_lang as lemma_field %}
                            <td><div class='input-group'>

                                <label class='input-group-addon' for='id_lemma_{{ dataset_lang.language_code_2char }}'>
                                    {{lemma_field.label}}
                                </label>
                                <input name='lemma_{{ dataset_lang.language_code_2char }}' class='form-control' {% if lemma_field.value %}value='{{lemma_field.value}}'{% endif %}></div>
                            </td>
                            {% endwith %}

                            {% with searchform|get_keyword_field_for_language:dataset_lang as keyword_field %}
                            <td><div class='input-group'>
                                <label class='input-group-addon' for='id_keyword_{{ dataset_lang.language_code_2char }}'>{{keyword_field.label}}</label>
                                <input name='keyword_{{ dataset_lang.language_code_2char }}' class='form-control' {% if keyword_field.value %}value='{{keyword_field.value}}'{% endif %}></div>
                            </td>
                            {% endwith %}
                        </tr>
                        {% endfor %}
                    </table>
                </div>

                <div class="panel-group">
                    <div  class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-target="#searchpanels">{% trans "Search by Language and Basic Properties" %}</div>

                        <div id='searchpanels' class='collapse'>
                        <table class='table'>
                              <tr>
                                <td>
                                    <div class='input-group'>
                                        <label class='input-group-addon' for='id_signlanguage'>{{searchform.signlanguage.label}}</label>
                                        {{searchform.signlanguage}}
                                    </div>
                                </td>
                                <td>
                                    <div class='input-group'>
                                        <label class='input-group-addon' for='id_dialect'>{{searchform.dialect.label}}</label>
                                        {{searchform.dialect}}
                                    </div>
                                </td>
                              </tr>

                                                    <span class="select2 select2-container select2-container--below">
                                                        <span class="selection">
                                                            <span class="select2-selection select2-selection--multiple" role="combobox" aria-haspopup="true" tabindex="-1"></span>
                                                        </span>
                                                    </span>
                        </table>

                        <table class='table'>
                            {% for fieldname,field,label in input_names_fields_and_labels.main %}

                                <tr><td><label for='id_{{fieldname}}'>{{label}}</label></td><td>{{field}}</td></tr>

                            {% endfor %}

                        </table>

                        </div>
                      </div>

                    <div  class="panel panel-default">
                      <div class="panel-heading" data-toggle="collapse" data-target="#morph_search">{% trans "Search by Morphology" %}</div>

                      <div id='morph_search' class='collapse'>
                      <table class='table table-condensed'>
                        <tr>
                        {% csrf_token %}
                          <td>
                            <table class='table table-condensed'>
                                <tr>
                                    <td><label for='id_morpheme'>{{searchform.morpheme.label}}</label></td>
                                    <td>
                                        <input class='form-control morphtypeahead' placeholder='{% trans "Morpheme Gloss" %}' value="{{searchform.morpheme.value|default:''}}"/>
                                        <input type="hidden" name='morpheme' value=""/>
                                    </td>
                                </tr>
                                <tr><td><label for='id_hasComponentOfType'>{{searchform.hasComponentOfType.label}}</label></td><td>{{searchform.hasComponentOfType}}</td></tr>
                                <tr><td><label for='id_hasMorphemeOfType'>{{searchform.hasMorphemeOfType.label}}</label></td><td>{{searchform.hasMorphemeOfType}}</td></tr>
                            </table>

                          </td>
                        </tr>
                      </table>
                      </div>
                    </div>

                    <div  class="panel panel-default">
                      <div class="panel-heading" data-toggle="collapse" data-target="#phon_search">{% trans "Search by Phonology" %}</div>

                      <div id='phon_search' class='collapse'>
                      <table class='table table-condensed'>
                        <tr>

                          <td>
                            <table class='table table-condensed'>
                                {% for fieldname,field,label in input_names_fields_and_labels.phonology %}

                                    <tr>
                                        <td><label>{{label}}</label></td><td>{{field}}</td>
                                        {% if fieldname == 'handedness' %}
                                            {% for handednessfieldname,handednessfield,handednesslabel in input_names_fields_labels_handedness %}
                                                <td><label for='id_{{handednessfieldname}}'>{{handednesslabel}}</label></td><td>{{handednessfield}}</td>
                                            {% endfor %}
                                        {% elif fieldname == 'domhndsh' %}
                                            {% for domhndshfieldname,domhndshfield,domhndshlabel in input_names_fields_labels_domhndsh %}
                                                <td><label for='id_{{domhndshfieldname}}'>{{domhndshlabel}}</label></td><td>{{domhndshfield}}</td>
                                            {% endfor %}
                                        {% elif fieldname == 'subhndsh' %}
                                            {% for subhndshfieldname,subhndshfield,subhndshlabel in input_names_fields_labels_subhndsh %}
                                                <td><label for='id_{{subhndshfieldname}}'>{{subhndshlabel}}</label></td><td>{{subhndshfield}}</td>
                                            {% endfor %}
                                        {% endif %}
                                    </tr>
                                {% endfor %}

                            </table>

                          </td>
                        </tr>
                      </table>
                      </div>
                    </div>

                    <div  class="panel panel-default">
                      <div class="panel-heading" data-toggle="collapse" data-target="#sem_search">{% trans "Search by Semantics" %}</div>

                      <div id='sem_search' class='collapse'>
                      <table class='table table-condensed'>
                        <tr>

                          <td>
                            <table class='table table-condensed'>
                                {% for fieldname,field,label in input_names_fields_and_labels.semantics %}

                                    <tr><td><label for='id_{{fieldname}}'>{{label}}</label></td><td>{{field}}</td></tr>

                                {% endfor %}



                            </table>

                          </td>
                        </tr>
                      </table>
                      </div>
                    </div>

                    <div  class="panel panel-default">
                      <div class="panel-heading" data-toggle="collapse" data-target="#rel_search">{% trans "Search by Relation" %}</div>

                      <div id='rel_search' class='collapse'>
                      <table class='table'>
                        <tr>

                              <tr>
                                <td>
                                    <div class='input-group'>
                                        <label class='input-group-addon' for='id_relation'>{{searchform.relation.label}}</label>
                                        {{searchform.relation}}
                                    </div>
                                </td>
                                <td>
                                    <div class='input-group'>
                                        <label class='input-group-addon' for='id_hasRelation'>{{searchform.hasRelation.label}}</label>
                                        {{searchform.hasRelation}}
                                    </div>
                                </td>
                              </tr>

                              <tr>
                                <td>
                                    <div class='input-group'>
                                        <label class='input-group-addon' for='id_relationToForeignSign'>{{searchform.relationToForeignSign.label}}</label>
                                        {{searchform.relationToForeignSign}}
                                    </div>
                                </td>

                                <td>
                                    <div class='input-group'>
                                        <label class='input-group-addon' for='id_hasRelationToForeignSign'>{{searchform.hasRelationToForeignSign.label}}</label>
                                        {{searchform.hasRelationToForeignSign}}
                                    </div>
                                </td>

                              </tr>


                        </tr>
                      </table>
                      </div>
                    </div>

                    <div  class="panel panel-default">
                      <div class="panel-heading" data-toggle="collapse" data-target="#pub_search">{% trans "Search by Publication Status and Notes" %}</div>

                      <div id='pub_search' class='collapse'>
                      <table class='table'>
                          <tr>
                            <td>
                                <div class='input-group'>
                                    <label class='input-group-addon' for='id_inWeb'>{{searchform.inWeb.label}}</label>
                                    {{searchform.inWeb}}
                                </div>
                            </td>
                            <td>
                                <div class='input-group'>
                                    <label class='input-group-addon' for='id_isNew'>{{searchform.isNew.label}}</label>
                                    {{searchform.isNew}}
                                </div>
                            </td>
                          </tr>

                          <tr>
                            <td>
                                <div class='input-group'>
                                    <label class='input-group-addon' for='id_definitionRole'>{{searchform.definitionRole.label}}</label>
                                    {{searchform.definitionRole}}
                                </div>
                            </td>
                            <td>
                                <div class='input-group'>
                                    <label class='input-group-addon' for='id_definitionContains'>{{searchform.definitionContains.label}}</label>
                                    {{searchform.definitionContains}}
                                </div>
                            </td>
                          </tr>

                          <tr>
                            <td>
                                <div class='input-group'>
                                    <label class='input-group-addon' for='id_definitionRole'>{{searchform.createdBefore.label}}</label>
                                    {{searchform.createdBefore}}
                                </div>
                            </td>
                            <td>
                                <div class='input-group'>
                                    <label class='input-group-addon' for='id_definitionContains'>{{searchform.createdAfter.label}}</label>
                                    {{searchform.createdAfter}}
                                </div>
                            </td>
                          </tr>

                          <tr>
                              <td>
                                  <div class='input-group'>
                                    <label class='input-group-addon' for='id_createdBy'>{{searchform.createdBy.label}}</label>
                                    {{searchform.createdBy}}
                                  </div>
                              </td>
                          </tr>

                          <tr>
                              <td>
                                  <div class='input-group'>
                                    <label class='input-group-addon' for='id_language'>{{searchform.tags.label}}</label>
                                    {{searchform.tags}}
                                  </div>
                              </td>
                          </tr>

                      </table>

                      </div>
                    </div>
                </div>

        </div>

    </div>

</div>

    <div class='btn-group' style="margin-bottom: 20px">
        <!-- Make sure no button has the *name* 'submit', otherwise submit() cannot be used -->

        {% if SHOW_MORPHEME_SEARCH %}
        <div class="btn-group">
            <a class='btn btn-primary dropdown-toggle' data-toggle="dropdown" type='submit' name='submit_button'>
            <span data-bind="label" onclick="do_adminsearch(this);" name="search_type" value="{{search_type}}">
                {% if search_type == 'sign' %}
                {% trans "Search sign" %}
                {% else %}
                {% trans "Search sign or morpheme" %}
                {% endif %}
            </span>&nbsp;<span class="caret"></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-left">
                <li><a href="#" onclick="do_adminsearch(this);" type='submit' name="search_type" value="sign">{% trans "Search sign" %}</a></li>
                <li><a href="#" onclick="do_adminsearch(this);" type='submit' name="search_type" value="morpheme">{% trans "Search morpheme" %}</a></li>
                <li><a href="#" onclick="do_adminsearch(this);" type='submit' name="search_type"
                       value="sign_or_morpheme">{% trans "Sign or morpheme" %}</a></li>
            </ul>
        </div>

        <!-- The element below adds an invisible submit option, so the 'button' above also works when enter is pressed -->
        <input type="submit" style="visibility: hidden;"/>

        {% else %}
        <input class="btn btn-primary" type="submit" name="search_type" value='{% trans "Search sign" %}'/>
        {% endif %}

        {% if perms.dictionary.export_csv %}
        <input class='btn btn-default' type='submit' name='format' value='CSV'>
        {% endif %}

        {% if not SHOW_DATASET_INTERFACE_OPTIONS %}
        {% if perms.dictionary.export_ecv %}
        <input class='btn btn-default' type='submit' name='export_ecv' value='ECV'>
        {% endif %}
        {% endif %}
        <input class='btn btn-default' type='submit' onclick="return clearForm(document.adminsearch);"
               value='{% trans "Reset" %}'>
    </div>

    <div class='form-group' id='paginate_by'>
        <label for='paginate_by'>{% trans "Results per page" %}</label>
        <select class='form-control' name="paginate_by">
            <option {% if paginate_by == 3000 %}selected{% endif %}>3000</option>
            <option {% if paginate_by == 2000 %}selected{% endif %}>2000</option>
            <option {% if paginate_by == 1000 %}selected{% endif %}>1000</option>
            <option {% if paginate_by == 500 %}selected{% endif %}>500</option>
            <option {% if paginate_by == 100 %}selected{% endif %}>100</option>
            <option {% if paginate_by == 50 %}selected{% endif %}>50</option>
            <option {% if paginate_by == 25 %}selected{% endif %}>25</option>
            <option {% if paginate_by == 10 %}selected{% endif %}>10</option>
        </select>
    </div>

    <div>
        <a class='btn' style="color:black;" type='submit' onclick="do_toggle_groups(this);">
            {% if view_type == "gloss_list" %}
            <label>{% trans "List View" %}</label>&nbsp;
            <button class="btn btn-primary" type="submit" name="view_type" value='lemma_groups'/>{% trans "Lemma View" %}</button>
            {% else %}
            <label>{% trans "Lemma View" %}</label>&nbsp;
            <button class="btn btn-primary" type="submit" name="view_type" value='gloss_list'/>{% trans "List View" %}</button>
            {% endif %}
        </a>
        {% trans "Number of matches:" %} {{page_obj.paginator.count}} {% trans "out of" %} {{glosscount}}.
        {% if SHOW_DATASET_INTERFACE_OPTIONS and selected_datasets %}
        {% trans "Datasets:" %}
        {% for ds in selected_datasets %}{{ds.name}}{% if not forloop.last %}, {% else %}.{% endif %}
        {% endfor %}
        {% endif %}
    </div>
</form>
{% endif %}

<div></div>

{% if perms.dictionary.add_gloss %}
<div  class="panel panel-default">
  <div class="panel-heading" data-toggle="collapse"  data-target='#add_gloss_form'>{% trans "Add New Sign" %}</div>

     <div id='add_gloss_form' class='collapse'>
         <form action='{% url "dictionary:add_gloss" %}' method='post'>
             {% csrf_token %}
             <table class='table'>
                 <tr>
                     {% if SHOW_DATASET_INTERFACE_OPTIONS %}<th><label for='dataset'>{% trans "Dataset" %}</label></th>{% endif %}
                     <th><label for='id_idgloss'>{% trans "Lemma ID Gloss" %}</label></th>
                     {% for dataset_lang in dataset_languages %}
                     <th id="add_gloss_dataset_header_{{ dataset_lang.language_code_2char }}"><label for="id_annotation_idgloss_{{ dataset_lang.language_code_2char }}">{% trans "Annotation ID Gloss" %} ({{ dataset_lang.name }})</label></th>
                     {% endfor %}
                     <th></th>
                 </tr>
                 <tr>
                     {% if SHOW_DATASET_INTERFACE_OPTIONS %}
                     <td><select id="id_dataset" name="dataset" required="">
                         <option value="" selected dataset_languages="{% for dataset_lang in dataset_languages %}{{ dataset_lang.language_code_2char }}{% if not forloop.last %},{% endif %}{% endfor %}">---------</option>
                         {% for dataset in selected_datasets %}
                         <option value="{{ dataset.id }}" dataset_languages="{% for dataset_lang in dataset.translation_languages.all %}{{ dataset_lang.language_code_2char }}{% if not forloop.last %},{% endif %}{% endfor %}">{{ dataset.name }}</option>
                         {% endfor %}
                     </select></td>
                     {% else %}
                     <div style="display: hidden"><select id="id_dataset" name="dataset"></select></div>
                     <script type='text/javascript'>gloss_dataset_id = {{ selected_datasets.0.id }}</script>
                     {% endif %}
                     <td>
                         <div id="lemma_select">
                             <!-- Input of the type ahead -->
                             <input class='form-control lemmatypeahead' placeholder='{% trans "Lemma" %}' />
                             <!-- Input that holds the lemma id the user chose from the type ahead -->
                             <input type='hidden' name='idgloss' value='confirmed' required="">
                             <a href="#" onclick="return toggleAddLemma()">{% trans "Create new" %}</a>
                         </div>
                         <div id="lemma_add">
                            {% for dataset_lang in dataset_languages %}
                             <span id="{{ lemma_create_field_prefix }}_header_{{ dataset_lang.language_code_2char }}">{{ dataset_lang.name }}:</span>
                            <input id="{{ lemma_create_field_prefix }}{{ dataset_lang.language_code_2char }}"
                                   name="{{ lemma_create_field_prefix }}{{ dataset_lang.language_code_2char }}"
                                   maxlength="30" type="text"/>

                            {% endfor %}

                             <a href="#" onclick="return toggleAddLemma()">{% trans "Select" %}</a>
                         </div>
                         <input type="hidden" id="select_or_new_lemma" name="select_or_new_lemma" value="select"/>
                     </td>
                     {% for dataset_lang in dataset_languages %}
                     <td id="add_gloss_dataset_value_{{ dataset_lang.language_code_2char }}">
                         <input id="glosscreate_{{ dataset_lang.language_code_2char }}" name="glosscreate_{{ dataset_lang.language_code_2char }}" maxlength="30" type="text"/>
                     </td>
                     {% endfor %}
                     <td><input class='btn btn-primary' type='submit' value='{% trans "Add New Sign" %}'></td>
                 </tr>
             </table>

         </form>
     </div>
  </div>
  {% endif %}



<!--<form id='toggle_groups' name='toggle_groups' method='get'>-->
    <!--<div class="hidden">-->
        <!--<input name='view_type' class='form-control' value='{{view_type}}'>-->
    <!--</div>-->

<!--</form>-->

<!--<p>{% trans "Number of matches:" %} {{page_obj.paginator.count}} {% trans "out of" %} {{glosscount}}.</p>-->

{% if view_type == "gloss_list" %}

{% if object_list %}
<table class='table table-condensed'>
    <thead>
      <tr>
          {% if SHOW_DATASET_INTERFACE_OPTIONS %}<th>{% trans "Dataset" %}</th>{% endif %}
          <th></th>
           {% for dataset_lang in dataset_languages %}
          <th>{% trans "Annotation ID Gloss" %} ({{ dataset_lang.name }})</th>
          {% endfor %}

          <th>{% trans "Lemma ID gloss" %}</th>

           <th>{% trans "Translation equivalents" %}</th>
           <th>{% trans "Handedness" %}</th>
           <th>{% trans "Strong hand" %}</th>
           <th>{% trans "Weak hand" %}</th>
           <th>{% trans "Location" %}</th>
           <th style="width:255px;">{% trans "Tags" %}</th>
      </tr>
      <!-- EK: this second header row contains clickable sort-order buttons -->
      <tr>
          <th></th>
          <th></th>
          {% for dataset_lang in dataset_languages %}
          {% with "annotationidglosstranslation_order_"|add:dataset_lang.language_code_2char as field %}
          {% with minfield="-"|add:field %}
           <th>
             <a href="#" onclick="do_sort_column('{{field}}','asc', 'adminsearch')">
               {% if searchform.sortOrder and searchform.sortOrder.value == field %}<font color="red">&#x25B2;</font>{% else %}&#x25B2; {% endif %}
             </a>
             <a href="#" onclick="do_sort_column('{{field}}','desc', 'adminsearch')">
               {% if searchform.sortOrder and searchform.sortOrder.value == minfield %}<font color="red">&#x25BC;</font>{% else %}&#x25BC;{% endif %}
             </a>
             {% if searchform.sortOrder and searchform.sortOrder.value == minfield or searchform.sortOrder and searchform.sortOrder.value == field  %}
               <a href="#" onclick="do_sort_column('{{field}}','del', 'adminsearch')">x</a>
             {% endif %}
           </th>
           {% endwith %}
           {% endwith %}
          {% endfor %}

           {% with "idgloss translation handedness domhndsh subhndsh locprim" as head_fields %}
           {% for field in head_fields.split  %}
           {% with minfield="-"|add:field %}
           <th>
             <a href="#" onclick="do_sort_column('{{field}}','asc', 'adminsearch')">
               {% if searchform.sortOrder and searchform.sortOrder.value == field %}<font color="red">&#x25B2;</font>{% else %}&#x25B2; {% endif %}
             </a>
             <a href="#" onclick="do_sort_column('{{field}}','desc', 'adminsearch')">
               {% if searchform.sortOrder and searchform.sortOrder.value == minfield %}<font color="red">&#x25BC;</font>{% else %}&#x25BC;{% endif %}
             </a>
             {% if searchform.sortOrder and searchform.sortOrder.value == minfield or searchform.sortOrder and searchform.sortOrder.value == field  %}
               <a href="#" onclick="do_sort_column('{{field}}','del', 'adminsearch')">x</a>
             {% endif %}
           </th>
           {% endwith %}
           {% endfor %}
           {% endwith %}
           <th style="width:255px;"></th>
      </tr>
    </thead>
    <tbody>
    {% for gloss in object_list %}
            <!-- EK: the color depends on: (1) tag for wrong sign, (2) availability of video, and (3) gloss database value for 'isNew' -->
            {% tags_for_object gloss as tag_list %}
            {% if tag_list|wrong_sign %}
                <tr class="danger">
            {% elif not gloss.has_video %}
                <tr class="warning">
            {% elif gloss.isNew %}
                <tr class="info">
            {% else %}
                <tr>
            {% endif %}

        {% if SHOW_DATASET_INTERFACE_OPTIONS %}<td>{{ gloss.dataset.name }}</td>{% endif %}
      <td>{%if gloss.get_image_path != None %}<div class="thumbnail_container">
          <a href="{{ URL }}/dictionary/gloss/{{gloss.pk}}/"><img class="thumbnail {% if CROP_GLOSS_IMAGES %}cropped_thumbnail{% endif %}" src="{{protected_media_url}}{{gloss.get_image_path}}"></div></a>{% endif %}
      </td>

      {% for dataset_lang in dataset_languages %}
        {% with gloss|get_annotation_idgloss_translation:dataset_lang as annotationidglosstranslation %}
      <td>
          {% ifnotequal annotationidglosstranslation "" %}
            {% if request.search_type == "sign_or_morpheme" and gloss.is_morpheme %}
            <div class="morpheme_gloss"><a href="{{ URL }}/dictionary/morpheme/{{gloss.pk}}/">{{annotationidglosstranslation}}</a></div>
            {% else %}
            <div><a href="{{ URL }}/dictionary/gloss/{{gloss.pk}}/">{{annotationidglosstranslation}}</a></div>
            {% endif %}

            {% if gloss.simultaneous_morphology.count > 0 %}
              {% if gloss.simultaneous_morphology.count > 3 %}
                  <span class="morpheme_in_gloss">({{gloss.simultaneous_morphology.all.count}} {% trans "morphemes" %})</span>
              {% else %}
                  <!-- Number of morphemes is [1-3] -->
                  <div class="morpheme_in_gloss">
                  {% for morphdef in gloss.simultaneous_morphology.all %}
                  <span><a class="morpheme_style" href="{{ URL }}/dictionary/morpheme/{{morphdef.morpheme.pk}}/">{{ morphdef.morpheme|get_annotation_idgloss_translation:dataset_lang }}</a>{% if not forloop.last %}, {% endif %}</span>
                  {% endfor %}
                  </div>
              {% endif %}
            {% endif %}

            {% if gloss.parent_glosses.count > 0 %}
              <div class="component_in_gloss">
              {% for component in gloss.parent_glosses.all %}
                  <span><a  class="gloss_detail_component" href="{{ URL }}/dictionary/gloss/{{component.morpheme.pk}}/">{{ component.morpheme|get_annotation_idgloss_translation:dataset_lang }}</a>{% if not forloop.last %} + {% endif %}</span>
              {% endfor %}
              </div>
            {% endif %}
          {% endifnotequal %}
      </td>
        {% endwith %}
      {% endfor %}

      <td>
          {% if request.search_type == "sign_or_morpheme" and gloss.is_morpheme %}
          <div class="morpheme_gloss">{{gloss.lemma}}</div>
          {% else %}
          <div>{{gloss.lemma}}</div>
          {% endif %}
      </td>

      <td>
      {% for translation in gloss.translation_set.all %}
                {% if forloop.last %}
                {{ translation.translation }}
                {% else%}
                {{ translation.translation }},
                {% endif %}

      {% endfor %}
      </td>

            {% load field_choice %}

            {% if request.LANGUAGE_CODE == 'nl' %}
                <td>{{ gloss.handedness|translate_to_dutch:"Handedness" }}</td>

                <!--Catch empty/undefined Handshape values in order to create hyperlinks-->

                {% with gloss.domhndsh|translate_to_dutch:"Handshape" as domhndsh_display %}
                    {% if domhndsh_display == '-' or domhndsh_display == 'N/A' or domhndsh_display == '' %}
                        <td>{{ domhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.domhndsh}}/">{{ domhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}
                {% with gloss.subhndsh|translate_to_dutch:"Handshape" as subhndsh_display %}
                    {% if subhndsh_display == '-' or subhndsh_display == 'N/A' or subhndsh_display == '' %}
                        <td>{{ subhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.subhndsh}}/">{{ subhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}

                <td>{{ gloss.locprim|translate_to_dutch:"Location" }}</td>

            {% elif request.LANGUAGE_CODE == 'zh-hans' %}
                <td>{{ gloss.handedness|translate_to_chinese:"Handedness" }}</td>

                <!--Catch empty/undefined Handshape values in order to create hyperlinks-->

                {% with gloss.domhndsh|translate_to_chinese:"Handshape" as domhndsh_display %}
                    {% if domhndsh_display == '-' or domhndsh_display == 'N/A' or domhndsh_display == '' %}
                        <td>{{ domhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.domhndsh}}/">{{ domhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}
                {% with gloss.subhndsh|translate_to_chinese:"Handshape" as subhndsh_display %}
                    {% if subhndsh_display == '-' or subhndsh_display == 'N/A' or subhndsh_display == '' %}
                        <td>{{ subhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.subhndsh}}/">{{ subhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}

                <td>{{ gloss.locprim|translate_to_chinese:"Location" }}</td>

            {% else %}

                <!--Catch empty/undefined Handshape values in order to create hyperlinks-->
                <!--The translate_to_english function is needed to avoid None values showing up in display-->

                <td>{{ gloss.handedness|translate_to_english:"Handedness" }}</td>

                {% with gloss.domhndsh|translate_to_english:"Handshape" as domhndsh_display %}
                    {% if domhndsh_display == '-' or domhndsh_display == 'N/A' or domhndsh_display == '' %}
                        <td>{{ domhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.domhndsh}}/">{{ domhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}
                {% with gloss.subhndsh|translate_to_english:"Handshape" as subhndsh_display %}
                    {% if subhndsh_display == '-' or subhndsh_display == 'N/A' or subhndsh_display == '' %}
                        <td>{{ subhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.subhndsh}}/">{{ subhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}

                <td>{{ gloss.locprim|translate_to_english:"Location" }}</td>
            {% endif %}

            {% load underscore_to_space %}
            {% tags_for_object gloss as tag_list %}
            <td>{% for tag in tag_list %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>

        </tr>
    {% endfor %}
  </tbody>
</table>

<div class="pagination">
    <span class="step-links">

        <ul class='pagination pagination-sm'>
        {% if page_obj.has_previous %}
            <li><a href="?page={{ page_obj.previous_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">&laquo;</a></li>
        {% endif %}

          {% if  page_obj.number > 10 %}
            <li><a>...</a></li>
          {% endif %}

          {% for p in page_obj.paginator.page_range %}

             {% if p < page_obj.number|add:"10" and  p > page_obj.number|add:"-10" %}
             <li {% ifequal p page_obj.number %}class='active'{% endifequal %}>
             <a href='?page={{ p }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}'>{% ifequal p 0 %}Start{% else %}{{p}}{% endifequal %}</a>
             </li>
             {% endif %}

          {% endfor %}

          {% if page_obj.paginator.num_pages > page_obj.number|add:"10" %}
            <li><a>...</a></li>
            <li>
            <a href='?page={{ page_obj.paginator.num_pages }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}'>{{page_obj.paginator.num_pages}}</a>
            </li>
          {% endif %}

        {% if page_obj.has_next %}
            <li><a href="?page={{ page_obj.next_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">&raquo;</a></li>


      </ul>


        {% endif %}
    </span>
</div>





{% endif %}

{% else %}  <!--show lemma groups view-->


{% if object_list %}

{% regroup object_list by idgloss as lemma_groups %}

<table class='table table-condensed'>
    <thead>
      <tr>
          <th>{% trans "Lemma ID gloss" %}</th>
          {% if SHOW_DATASET_INTERFACE_OPTIONS %}<th>{% trans "Dataset" %}</th>{% endif %}
          <th></th>

           {% for dataset_lang in dataset_languages %}
           <th>{% trans "Annotation ID Gloss" %} ({{ dataset_lang.name }})</th>
           {% endfor %}

           <th>{% trans "Translation equivalents" %}</th>
           <th>{% trans "Handedness" %}</th>
           <th>{% trans "Strong hand" %}</th>
           <th>{% trans "Weak hand" %}</th>
           <th>{% trans "Location" %}</th>
           <th style="width:255px;">{% trans "Tags" %}</th>
      </tr>
      <!-- EK: this second header row contains clickable sort-order buttons -->
      <!-- Sorting removed for Lemma Groups View -->

    </thead>
    <tbody>
    {% for lemma in lemma_groups %}
        {% if lemma.list|length > 1 %}
        <tr>

      <td>
          {% if request.search_type == "sign_or_morpheme" and gloss.is_morpheme %}
          <div class="morpheme_gloss">{{lemma.grouper}}</div>
          {% else %}
          <div>{{lemma.grouper}}</div>
          {% endif %}
      </td>
        </tr>
      {% for gloss in lemma.list %}
        <tr>
        <td></td>
        {% if SHOW_DATASET_INTERFACE_OPTIONS %}<td>{{ gloss.dataset.name }}</td>{% endif %}
      <td>{%if gloss.get_image_path != None %}<div class="thumbnail_container">
          <a href="{{ URL }}/dictionary/gloss/{{gloss.pk}}/"><img class="thumbnail {% if CROP_GLOSS_IMAGES %}cropped_thumbnail{% endif %}" src="{{protected_media_url}}{{gloss.get_image_path}}"></div></a>{% endif %}
      </td>

      {% for dataset_lang in dataset_languages %}
        {% with gloss|get_annotation_idgloss_translation:dataset_lang as annotationidglosstranslation %}
      <td>
          {% ifnotequal annotationidglosstranslation "" %}
            {% if request.search_type == "sign_or_morpheme" and gloss.is_morpheme %}
            <div class="morpheme_gloss"><a href="{{ URL }}/dictionary/morpheme/{{gloss.pk}}/">{{annotationidglosstranslation}}</a></div>
            {% else %}
            <div><a href="{{ URL }}/dictionary/gloss/{{gloss.pk}}/">{{annotationidglosstranslation}}</a></div>
            {% endif %}

            {% if gloss.simultaneous_morphology.count > 0 %}
              {% if gloss.simultaneous_morphology.count > 3 %}
                  <span class="morpheme_in_gloss">({{gloss.simultaneous_morphology.all.count}} {% trans "morphemes" %})</span>
              {% else %}
                  <!-- Number of morphemes is [1-3] -->
                  <div class="morpheme_in_gloss">
                  {% for morphdef in gloss.simultaneous_morphology.all %}
                  <span><a class="morpheme_style" href="{{ URL }}/dictionary/morpheme/{{morphdef.morpheme.pk}}/">{{ morphdef.morpheme|get_annotation_idgloss_translation:dataset_lang }}</a>{% if not forloop.last %}, {% endif %}</span>
                  {% endfor %}
                  </div>
              {% endif %}
            {% endif %}

            {% if gloss.parent_glosses.count > 0 %}
              <div class="component_in_gloss">
              {% for component in gloss.parent_glosses.all %}
                  <span><a class="gloss_detail_component" href="{{ URL }}/dictionary/gloss/{{component.morpheme.pk}}/">{{ component.morpheme|get_annotation_idgloss_translation:dataset_lang }}</a>{% if not forloop.last %} + {% endif %}</span>
              {% endfor %}
              </div>
            {% endif %}
          {% endifnotequal %}
      </td>
        {% endwith %}
      {% endfor %}

      <td>
      {% for translation in gloss.translation_set.all %}
                {% if forloop.last %}
                {{ translation.translation }}
                {% else%}
                {{ translation.translation }},
                {% endif %}

      {% endfor %}
      </td>

            {% load field_choice %}

            {% if request.LANGUAGE_CODE == 'nl' %}
                <td>{{ gloss.handedness|translate_to_dutch:"Handedness" }}</td>

                <!--Catch empty/undefined Handshape values in order to create hyperlinks-->

                {% with gloss.domhndsh|translate_to_dutch:"Handshape" as domhndsh_display %}
                    {% if domhndsh_display == '-' or domhndsh_display == 'N/A' or domhndsh_display == '' %}
                        <td>{{ domhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.domhndsh}}/">{{ domhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}
                {% with gloss.subhndsh|translate_to_dutch:"Handshape" as subhndsh_display %}
                    {% if subhndsh_display == '-' or subhndsh_display == 'N/A' or subhndsh_display == '' %}
                        <td>{{ subhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.subhndsh}}/">{{ subhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}

                <td>{{ gloss.locprim|translate_to_dutch:"Location" }}</td>

            {% elif request.LANGUAGE_CODE == 'zh-hans' %}
                <td>{{ gloss.handedness|translate_to_chinese:"Handedness" }}</td>

                <!--Catch empty/undefined Handshape values in order to create hyperlinks-->

                {% with gloss.domhndsh|translate_to_chinese:"Handshape" as domhndsh_display %}
                    {% if domhndsh_display == '-' or domhndsh_display == 'N/A' or domhndsh_display == '' %}
                        <td>{{ domhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.domhndsh}}/">{{ domhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}
                {% with gloss.subhndsh|translate_to_chinese:"Handshape" as subhndsh_display %}
                    {% if subhndsh_display == '-' or subhndsh_display == 'N/A' or subhndsh_display == '' %}
                        <td>{{ subhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.subhndsh}}/">{{ subhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}

                <td>{{ gloss.locprim|translate_to_chinese:"Location" }}</td>

            {% else %}

                <!--Catch empty/undefined Handshape values in order to create hyperlinks-->
                <!--The translate_to_english function is needed to avoid None values showing up in display-->

                <td>{{ gloss.handedness|translate_to_english:"Handedness" }}</td>

                {% with gloss.domhndsh|translate_to_english:"Handshape" as domhndsh_display %}
                    {% if domhndsh_display == '-' or domhndsh_display == 'N/A' or domhndsh_display == '' %}
                        <td>{{ domhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.domhndsh}}/">{{ domhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}
                {% with gloss.subhndsh|translate_to_english:"Handshape" as subhndsh_display %}
                    {% if subhndsh_display == '-' or subhndsh_display == 'N/A' or subhndsh_display == '' %}
                        <td>{{ subhndsh_display }}</td>
                    {% else %}
                        <td><a href="{{ URL }}/dictionary/handshape/{{gloss.subhndsh}}/">{{ subhndsh_display }}</a></td>
                    {% endif %}
                {% endwith %}

                <td>{{ gloss.locprim|translate_to_english:"Location" }}</td>
            {% endif %}

            {% load underscore_to_space %}
            {% tags_for_object gloss as tag_list %}
            <td>{% for tag in tag_list %}<span class='tag'>{{tag.name|underscore_to_space}}</span> {% endfor %}</td>
        </tr>
        {% endfor %}
        {% endif %}
    {% endfor %}
  </tbody>
</table>


<div class="pagination">
    <span class="step-links">

        <ul class='pagination pagination-sm'>
        {% if page_obj.has_previous %}
            <li><a href="?page={{ page_obj.previous_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">&laquo;</a></li>
        {% endif %}

          {% if  page_obj.number > 10 %}
            <li><a>...</a></li>
          {% endif %}

          {% for p in page_obj.paginator.page_range %}

             {% if p < page_obj.number|add:"10" and  p > page_obj.number|add:"-10" %}
             <li {% ifequal p page_obj.number %}class='active'{% endifequal %}>
             <a href='?page={{ p }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}'>{% ifequal p 0 %}Start{% else %}{{p}}{% endifequal %}</a>
             </li>
             {% endif %}

          {% endfor %}

          {% if page_obj.paginator.num_pages > page_obj.number|add:"10" %}
            <li><a>...</a></li>
            <li>
            <a href='?page={{ page_obj.paginator.num_pages }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}'>{{page_obj.paginator.num_pages}}</a>
            </li>
          {% endif %}

        {% if page_obj.has_next %}
            <li><a href="?page={{ page_obj.next_page_number }}{% for key,value in request.GET.items %}{% ifnotequal key 'page' %}&{{ key }}={{ value }}{% endifnotequal %}{% endfor %}">&raquo;</a></li>


      </ul>


        {% endif %}
    </span>
</div>

{% endif %}
{% endif %}




{% endblock content %}
